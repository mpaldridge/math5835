<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Problem Sheet 5 – MATH5835M Statistical Computing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../coursework/coursework.html" rel="next">
<link href="../lectures/L27-bootstrap-ci.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../mystyle.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../lectures/L24-empirical.html">Resampling methods</a></li><li class="breadcrumb-item"><a href="../problems/P5.html">Problem Sheet 5</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">MATH5835</a> 
        <div class="sidebar-tools-main">
    <a href="../MATH5835M-Statistical-Computing.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About MATH5835</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Monte Carlo estimation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L01-mc-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Monte Carlo</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L02-mc-uses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Uses of Monte Carlo</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L03-mc-error-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Monte Carlo error I: theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L04-mc-error-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Monte Carlo error II: practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L05-cv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Control variate</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L06-antithetic-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Antithetic variables I</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problems/P1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Sheet 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L07-antithetic-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Antithetic variables II</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L08-is-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Importance sampling I</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L09-is-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Importance sampling II</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Random number generation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L10-rng-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Generating random numbers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L11-lcg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">LCGs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problems/P2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Sheet 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L12-uniform-discrete.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Uniform and discrete</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L13-inverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Inverse transform method</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L14-rejection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Rejection sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L15-envelope-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Envelope rejection sampling I</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L16-envelope-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Envelope rejection sampling II</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problems/P3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Sheet 3</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">MCMC</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L17-markov-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Markov chains in discrete space</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L18-markov-longrun.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Markov chains in the long run</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L19-mh-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Metropolis–Hastings in discrete space</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L20-markov-cont.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Markov chains in continuous space</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L21-mh-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Metropolis–Hastings in continuous space</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problems/P4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Sheet 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L22-mcmc-error.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">MCMC error</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L23-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">MCMC and Bayesian statistics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Resampling methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L24-empirical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Empirical distribution</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L25-plugin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Plug-in estimation &amp; Bootstrap I</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L26-bootstrap-error.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Bootstrap II</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/L27-bootstrap-ci.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Bootstrap III</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problems/P5.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Problem Sheet 5</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../coursework/coursework.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computational coursework</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problems/solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solutions</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<div class="hidden">
<p><span class="math display">\[ \newcommand{\Exg}{\operatorname{\mathbb{E}}} 
\newcommand{\Ex}{\mathbb{E}} 
\newcommand{\Ind}{\mathbb{I}}
\newcommand{\Var}{\operatorname{Var}}
\newcommand{\Cov}{\operatorname{Cov}}
\newcommand{\Corr}{\operatorname{Corr}}
\newcommand{\ee}{\mathrm{e}} \]</span></p>
</div>

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../lectures/L24-empirical.html">Resampling methods</a></li><li class="breadcrumb-item"><a href="../problems/P5.html">Problem Sheet 5</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="P5" class="quarto-section-identifier">Problem Sheet 5</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<style>
.myanswers { 
display: none !important;
}
</style>
<!--
::: {.mysummary}
**[Full solutions](#P2-sols)** are now available.
:::
-->
<div class="mysummary">
<p>This is Problem Sheet 4, which covers material from Lectures 22 to 27. You should work through all the questions on this problem sheet in advance of the problems class, which takes place in the lecture of <strong>Thursday 11 December</strong>.</p>
<p>This problem sheet is to help you practice material from the module and to help you check your learning. It is <em>not</em> for formal assessment and does not count towards your module mark.</p>
<p>If you want some brief informal feedback on <strong>Question 2</strong> (marked ★), you should submit your work electronically through Gradescope via the module’s Minerva page by <strong>1400 on Tuesday 9 December</strong>. (If you hand-write solutions on paper, the easiest way to scan-and-submit that work is using the Gradescope app on your phone.) I will return some brief comments on your those two questions by the problems class on Thursday 11 December. Because this informal feedback, and not part of the official assessment, I cannot accept late work for any reason – but I am always happy to discuss any of your work on any question in my office hours.</p>
<p>Full solutions will be released on Friday 12 December.</p>
<p>Remember that <strong>Thursday 11 December at 1400</strong> is also the deadline for the module <a href="#coursework">coursework</a></p>
</div>
<div class="hidden">
<p><span class="math display">\[ \]</span></p>
</div>
<div class="myq">
<p><strong>1.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The Gamma distribution <span class="math inline">\(X \sim \Gamma(m, \lambda)\)</span> has PDF <span class="math display">\[ f(x) = \frac{\lambda^m}{(m-1)!} \,x^{m-1}\,\mathrm{e}^{-\lambda x} . \]</span> (This PDF can be evaluated with the <code>dgamma()</code> function in R.) The time between eruptions of a volcano, measured in years, is modelled as <span class="math inline">\(X \sim \Gamma(5, \theta)\)</span>, IID over eruptions, where <span class="math inline">\(\theta\)</span> is unknown. A scientist beliefs about <span class="math inline">\(\theta\)</span> are represented in a prior distribution <span class="math inline">\(\theta \sim \operatorname{Exp}(6)\)</span>.</p>
<p>The following times between eruptions are available in the historical record:</p>
<pre><code>       56.55,  2.57, 29.97, 10.27,  4.32, 17.91, 51.98,  7.06, 11.40, 54.80</code></pre>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sample from the posterior distribution for <span class="math inline">\(\theta\)</span>, using the random walk Metropolis algorithm. Explain how you chose the stepsize for your algorithm and how you checked it was a good choice.</p>
<p>Draw a histogram of the posterior distribution, and comment on how it differs from the prior.</p>
<div class="myanswers">
<p><em>Solution.</em> The posterior distribution is <span class="math display">\[ \pi(\theta \mid \mathbf x) \propto 6\mathrm{e}^{-6\theta} \times \prod_{i=1}^{10} x_i^{4} \, \mathrm{e}^{-\theta x_i} . \]</span></p>
<p>The code for the Metropolis random walk algorithm will be the following.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">56.55</span>,  <span class="fl">2.57</span>, <span class="fl">29.97</span>, <span class="fl">10.27</span>,  <span class="fl">4.32</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>       <span class="fl">17.91</span>, <span class="fl">51.98</span>,  <span class="fl">7.06</span>, <span class="fl">11.40</span>, <span class="fl">54.80</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) <span class="fu">dexp</span>(theta, <span class="dv">6</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>like  <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) <span class="fu">prod</span>(<span class="fu">dgamma</span>(x, <span class="dv">5</span>, theta))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>post  <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) <span class="fu">prior</span>(theta) <span class="sc">*</span> <span class="fu">like</span>(theta)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>accept <span class="ot">&lt;-</span> <span class="cf">function</span>(curr, prop) <span class="fu">post</span>(prop) <span class="sc">/</span> <span class="fu">post</span>(curr)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>initial <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>MRW <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>MRW[<span class="dv">1</span>] <span class="ot">&lt;-</span> initial</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  prop <span class="ot">&lt;-</span> MRW[i] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, sigma)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (prop <span class="sc">&lt;</span> <span class="dv">0</span>)                             MRW[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> MRW[i]</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> <span class="fu">accept</span>(MRW[i], prop)) MRW[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> prop</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>                                      MRW[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> MRW[i]</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(MRW[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>)], <span class="at">probability =</span> <span class="cn">TRUE</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(prior, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="P5_files/figure-html/unnamed-chunk-1-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A little experimentation suggested <span class="math inline">\(\sigma = 0.2\)</span> worked about right – <span class="math inline">\(\sigma = 0.5\)</span> rejected too many changes. With my initial start point of 1, I found a short burn-in period was necessary, so my histogram starts with the 100th step of the random walk. (I could have just started from 0.2 instead, I suppose.)</p>
<p>We see that while the prior thought any number between 0 and <span class="math inline">\(\tfrac12\)</span>, maybe even more, was plausible for <span class="math inline">\(\theta\)</span>, we can see the prior has become concentrated in the interval <span class="math inline">\([0.11, 0.32]\)</span> or so, with values around 0.2 the most common. The posterior variance is much smaller than the prior, so we have gained certainty from the results.</p>
</div>
</div>
<div class="myq">
<p><strong>2.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;★ <em>[2019 exam, Question 4]</em></p>
<div class="subq">
<p><strong>(a)</strong>&nbsp;&nbsp;&nbsp;Introducing any notation you use, state the Metropolis–Hastings algorithm for discrete state space, and explain the purpose of this algorithm.</p>
<div class="myanswers">
<p><em>Solution.</em> The Metropolis–Hastings algorithm is a method to sample from a distribution <span class="math inline">\(\pi\)</span> on a discrete space <span class="math inline">\(\mathcal S\)</span> by setting up a Markov chain <span class="math inline">\((X_i)\)</span> on <span class="math inline">\(\mathcal S\)</span> with stationary distribution <span class="math inline">\(\pi\)</span>.</p>
<p>Suppose the Markov chain is at <span class="math inline">\(X_i = x\)</span>. The Metropolis–Hastings algorithm proposes a move to <span class="math inline">\(y\)</span> with probability <span class="math inline">\(r(x, y)\)</span>, where <span class="math inline">\(\mathsf R = (r(x, y))\)</span> is the transition matrix for an irreducible Markov chain on <span class="math inline">\(\mathcal S\)</span>. This move is accepted with probability <span class="math display">\[ \alpha(x, y) = \min \left\{ \frac{\pi(y)\,r(y,x)}{\pi(x)\,r(x,y)},\, 1\right\} , \]</span> meaning that <span class="math inline">\(X_{i+1} = y\)</span>, or rejected otherwise, meaning that <span class="math inline">\(X_{i+1} = X_i = x\)</span>.</p>
<p>After being run for a large number of steps (possibly with a burn-in period), the values <span class="math inline">\(X_i\)</span> should be approximately distributed like <span class="math inline">\(\pi\)</span>.</p>
</div>
</div>
<div class="subq">
<p><strong>(b)</strong>&nbsp;&nbsp;&nbsp;Using the Metropolis–Hastings algorithm, find a Markov chain with state space <span class="math inline">\(\mathbb N = \{1, 2, 3, \dots\}\)</span> that has stationary distribution <span class="math inline">\(\mathbb P(X_n = x) = 2^{-x}\)</span> for <span class="math inline">\(x \in \mathbb N\)</span>.</p>
<div class="myanswers">
<p><em>Solution.</em> Although this isn’t the only way, I will use <span class="math inline">\(\mathsf R\)</span> to be the transition matrix of the simple symmetric random walk on <span class="math inline">\(\mathbf Z\)</span>. Because this is symmetric, the acceptance probabilities are <span class="math display">\[\begin{align}
\alpha(x, x+1) &amp;= \min \left\{ \frac{\pi(x+1)}{\pi(x)},\, 1 \right\} = \min\big\{\tfrac12,\, 1\big\} = \tfrac 12 \\
\alpha(x, x-1) &amp;= \min \left\{ \frac{\pi(x-1)}{\pi(x)},\, 1 \right\} = \min\{2,\, 1\} = 1,
\end{align}\]</span> except that <span class="math inline">\(\alpha(1, 0) = 1\)</span>.</p>
<p>I’ll choose the starting point <span class="math inline">\(X = 1\)</span>. From here, the Markov chain repeatedly proposes a move up 1 with probability <span class="math inline">\(\tfrac12\)</span>, which is accepted with probability <span class="math inline">\(\tfrac12\)</span>, or a move down 1 with probability <span class="math inline">\(\tfrac12\)</span>, which is always accepted – except for a move from 1 down to 0 which is always rejected.</p>
</div>
</div>
<div class="subq">
<p><strong>(c)</strong>&nbsp;&nbsp;&nbsp;In a Bayesian setting, assume we have observations <span class="math inline">\(Z_1, X_2, \dots, Z_n\)</span> from an <span class="math inline">\(\operatorname{N}(0, \sigma^2)\)</span> distribution, where the prior distribution for <span class="math inline">\(\sigma^2\)</span> is <span class="math inline">\(\operatorname{Exp}(1)\)</span>. Using the Metropolis–Hastings algorithm, describe in detail a method for sampling from the posterior distribution of <span class="math inline">\(\sigma^2\)</span>.</p>
<div class="myanswers">
<p><em>Solution</em> The posterior distribution is given by <span class="math display">\[\begin{align}
\pi(\sigma^2 \mid \mathbf Z) &amp;\propto \pi(\sigma^2) \prod_{i=1}^n f(z_i \mid \sigma^2) \\
  &amp;= \mathrm{e}^{-\sigma^2} \prod_{i=1}^n \frac{1}{\sqrt{\sigma^2}} \,\exp\left(- \frac{Z_i^2}{2\sigma^2} \right) \\
  &amp;=  \mathrm{e}^{-\sigma^2} \,\sigma^{-n/2} \,\exp\left(-\frac{1}{2\sigma^2} \sum_{i=1}^n Z_i^2 \right) .
\end{align}\]</span></p>
<p>I will choose as the Markov chain a symmetric Gaussian random walk on <span class="math inline">\(\mathbb R\)</span>, meaning that the Markov chain is <span class="math inline">\(X_{i+1} = X_i + \mathrm{N}(0, s^2)\)</span>. (The special case is known as the random walk Metropolis algorithm in continuous space.) Because this is symmetric, the acceptance probability is <span class="math display">\[ \alpha(x, y) = \min \left\{ \frac{ \pi(x \mid \mathbf Z)}{\pi(y \mid \mathbf Z)},\,1\right\} , \]</span> for <span class="math inline">\(y \geq 0\)</span>, where the constant of proportionality in the <span class="math inline">\(\pi\)</span>s cancel out, of <span class="math inline">\(\alpha(x, y) = 0\)</span> for <span class="math inline">\(y &lt; 0\)</span>.</p>
<p>I would suggest starting from <span class="math inline">\(X_1\)</span> between <span class="math inline">\(1\)</span> (the prior variance) and the sample variance of the <span class="math inline">\(Z_i\)</span> (the posterior variance in the large sample limit <span class="math inline">\(n \to \infty\)</span>). I would suggest choosing the step size <span class="math inline">\(s\)</span> by experiment, with smaller <span class="math inline">\(s\)</span> for large <span class="math inline">\(n\)</span>, and vice versa.</p>
</div>
</div>
<div class="subq">
<p><strong>(d)</strong>&nbsp;&nbsp;&nbsp;Let the set <span class="math inline">\(A \subset \mathbb R^2\)</span> be given by <span class="math display">\[
A = \big([0,3]\times[0,1]\big) \cup \big([0,1]\times [4,5]\big)
\cup \big([4,5]\times[0,1]\big) \cup \big([4,5] \times [3,5]\big) .
\]</span> Consider the Metropolis–Hastings algorithm on <span class="math inline">\(\mathbb R^2\)</span> with target density <span class="math display">\[ \pi(\mathbf x) = \begin{cases} \frac17 &amp; \text{if }\mathbf x \in A \\
0 &amp; \text{otherwise} \end{cases} \]</span> for all <span class="math inline">\(x \in \mathbb R^2\)</span>, and where the proposals <span class="math inline">\(\mathbf Y_{i+1}\)</span> are chosen uniformly distributed on a disk of radius <span class="math inline">\(r\)</span> around the previous state – that is, <span class="math display">\[ Y_{j+1} \sim \operatorname{U} \Big(\big\{ \mathbf y \in \mathbb R^2 : |\mathbf y - \mathbf X_i | \leq r \big\}\Big) . \]</span> Assume the algorithm starts at <span class="math inline">\(\mathbf X_1 = (0.5, 0.5)\)</span>.</p>
<p><strong>i.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For every <span class="math inline">\(r &gt; 0\)</span>, determine the stationary distribution of the resulting Markov chain.</p>
<p><strong>ii.</strong>&nbsp;&nbsp;&nbsp;&nbsp;For what values of <span class="math inline">\(r\)</span> does the algorithm work correctly?</p>
<div class="myanswers">
<p><em>Solution.</em> To see what’s going on where, we need to draw a picture of the set <span class="math inline">\(A\)</span>.</p>
<p>The question is: for what <span class="math inline">\(r\)</span> will it be possible to jump between the different blocks. We start from <span class="math inline">\((0.5, 0.5)\)</span> which is in the bottom-left block. To jump from bottom-left to bottom-right, we need <span class="math inline">\(r &gt; 1\)</span>. To jump from bottom-right to top-right, we need <span class="math inline">\(r &gt; 2\)</span>. To jump from bottom-left to top-left, we need <span class="math inline">\(r &gt; 3\)</span>.</p>
<p><strong>(i)</strong> The distribution is uniform, so as long as the Markov chain can <em>reach</em> an area, the stationary distribution will be uniform there. So the stationary distribution is uniform on the following sets:</p>
<ul>
<li><p><span class="math inline">\(0 &lt; r \leq 1\)</span>: <span class="math inline">\(\big([0,3]\times[0,1]\big)\)</span></p></li>
<li><p><span class="math inline">\(1 &lt; r \leq 2\)</span>: <span class="math inline">\(\big([0,3]\times[0,1]\big) \cup \big([4,5]\times[0,1]\big)\)</span></p></li>
<li><p><span class="math inline">\(2 &lt; r \leq 3\)</span>: <span class="math inline">\(\big([0,3]\times[0,1]\big) \cup \big([4,5]\times[0,1]\big) \cup \big([4,5] \times [3,5]\big)\)</span></p></li>
<li><p><span class="math inline">\(r &gt; 3\)</span>: <span class="math inline">\(A\)</span></p></li>
</ul>
<p>(If <span class="math inline">\(r\)</span> is only <em>just</em> above the boundary, convergence to the stationary distribution may be extremely slow.)</p>
<p><strong>(ii)</strong> The stationary distribution is the desired distribution for <span class="math inline">\(r &gt; 3\)</span>, which is the values for which the algorithm technically “works”, as <span class="math inline">\(n \to \infty\)</span>. To work “well”, <span class="math inline">\(r\)</span> will need to be comfortably bigger than 3 (so that movement to and from the top-left is reasonably common) while not being so huge that most steps are to ridiculously far away.</p>
</div>
</div>
</div>
<div class="myq">
<p><strong>3.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>[2017 exam, Question 5]</em></p>
<div class="subq">
<p><strong>(a)</strong>&nbsp;&nbsp;&nbsp;Give the definition of a Markov chain with state space <span class="math inline">\(\mathcal S\)</span>.</p>
<p>Let <span class="math inline">\((Z_i)\)</span> be a sequence of IID random variables whose distribution is known. Consider the stochastic processes <span class="math inline">\((U_i)\)</span>, <span class="math inline">\((V_i)\)</span>, <span class="math inline">\((W_i)\)</span> defined by <span class="math display">\[\begin{align}
U_i &amp;= Z_1 + Z_2 + \cdots + Z_i \\
V_i &amp;= \frac{1}{i} (Z_1 + Z_2 + \cdots + Z_i) \\
W_i &amp;= \max \{Z_j : 1 \leq j \leq i-1\} + Z_i
\end{align}\]</span> for <span class="math inline">\(i = 1, 2, \dots\)</span>. Which of these processes are Markov chains? Justify your answers.</p>
<div class="myanswers">
<p><em>Solution.</em> A Markov chain is a stochastic process <span class="math inline">\((X_n)\)</span> satisfying the Markov property <span class="math display">\[ \mathbb P(X_{n+1} = x_{n+1} \mid X_n = x_n, \dots, X_1 = x_1) = \mathbb P(X_{n+1} = x_{n+1} \mid X_n = x_n) \]</span> for all states <span class="math inline">\(x_{n+1}, x_n, \dots, x_1 \in \mathcal S\)</span> such that the conditional probabilities are defined.</p>
<p>Since <span class="math inline">\(U_{i+1} = U_{i} + Z_{i+1}\)</span>, this satisfies the Markov property (and, indeed, is a random walk).</p>
<p>Since $V_{i+1} = V_i + Z_{i+1} $, this satisfies the Markov property.</p>
<p>This does not satisfy the Markov property. Suppose <span class="math inline">\(Z_i = \pm 1\)</span> with probability <span class="math inline">\(\frac12\)</span> each. Then <span class="math inline">\(W_1 = Z_1\)</span> and <span class="math inline">\(W_2 = W_1 + Z_2 = Z_1 + Z_2\)</span>. Suppose <span class="math inline">\(W_2 = 0\)</span>. Then the distribution of <span class="math inline">\(W_3\)</span> does not solely depend on <span class="math inline">\(W_2\)</span>, conditionally independent of <span class="math inline">\(W_1\)</span>. If <span class="math inline">\(W_1 = Z_1 = +1\)</span>, then <span class="math display">\[ W_3 = \max\{W_1, W_2\} + Z_3 = \max\{1, 0\} + Z_3 = 1 + Z_3 , \]</span> while if <span class="math inline">\(W_1 = Z_1 = -1\)</span>, then <span class="math display">\[ W_3 = \max\{W_1, W_2\} + Z_3 = \max\{-1, 0\} + Z_3 = Z_3 . \]</span></p>
</div>
</div>
<div class="subq">
<p><strong>(b)</strong>&nbsp;&nbsp;&nbsp;Defining any notation you use, state the random walk Metropolis algorithm. What is the purpose of this algorithm?</p>
<div class="myanswers">
<p><em>Solution.</em> The purpose of the random walk Metropolis algorithm is to approximately sample from a distribution <span class="math inline">\(\pi\)</span> on the integers <span class="math inline">\(\mathcal S = \mathbb Z\)</span>.</p>
<p>We form a Markov chain <span class="math inline">\((X_i)\)</span> by making proposals that are accepted or rejected. From <span class="math inline">\(X_i = x\)</span> we propose a move to <span class="math inline">\(y = x+1\)</span> with probability <span class="math inline">\(\frac12\)</span> or to <span class="math inline">\(y = x-1\)</span> with probability <span class="math inline">\(\frac12\)</span>. Such a proposal is accepted with probability <span class="math display">\[\alpha(x, y) = \min \left\{ \frac{\pi(y)}{\pi(x)} , \, 1 \right\} . \]</span> An acceptance means <span class="math inline">\(X_{i+1} = y\)</span>, while a rejection means <span class="math inline">\(X_{i+1} = x\)</span>. This is repeated <span class="math inline">\(n\)</span> times.</p>
</div>
</div>
<div class="subq">
<p><strong>(c)</strong>&nbsp;&nbsp;&nbsp;Use the Metropolis–Hastings algorithm to define a Markov chain <span class="math inline">\((X_n)\)</span> on <span class="math inline">\(\mathcal S = \{0, 1, 2, \dots \}\)</span> whose stationary distribution is the Poisson distribution <span class="math inline">\(\pi(x) = \mathrm{e}^{-\lambda} \lambda^x/x!\)</span>.</p>
<div class="myanswers">
<p><em>Solutions.</em> Proposals are made as in part (b) above. The acceptance probability for an “up” move is <span class="math display">\[\begin{align*}
\alpha(x, x+1) &amp;= \min \left\{ \frac{\pi(x+1)}{\pi(x)} , \, 1 \right\} \\
&amp;= \min \left\{ \frac{\mathrm{e}^{-\lambda} \lambda^{x+1}/(x+1)! }{\mathrm{e}^{-\lambda} \lambda^{x}/x!} , \, 1 \right\} \\
&amp;= \min \left\{ \frac{\lambda}{x+1} , \, 1 \right\} .
\end{align*}\]</span> The acceptance probability for a “down” move is <span class="math display">\[\begin{align*}
\alpha(x, x-1) &amp;= \min \left\{ \frac{\pi(x-1)}{\pi(x)} , \, 1 \right\} \\
&amp;= \min \left\{ \frac{\mathrm{e}^{-\lambda} \lambda^{x-1}/(x-1)! }{\mathrm{e}^{-\lambda} \lambda^{x}/x!} , \, 1 \right\} \\
&amp;= \min \left\{ \frac{x}{\lambda} , \, 1 \right\} .
\end{align*}\]</span> for <span class="math inline">\(x &gt; 0\)</span>, or <span class="math inline">\(\alpha(0, -1) = 0\)</span>.</p>
<p>The starting point should be a non-negative integer; the nearest integer to <span class="math inline">\(\lambda\)</span> is a good choice.</p>
</div>
</div>
<div class="subq">
<p><strong>(d)</strong>&nbsp;&nbsp;&nbsp;Let <span class="math inline">\((X_i)\)</span> be a Markov chain with values in <span class="math inline">\(\mathbb R\)</span> and stationary distribution <span class="math inline">\(\pi\)</span>. Consider the estimator <span class="math display">\[\widehat{\theta}_n^{\mathrm{MCMC}} = \frac{1}{n} \sum_{i=1}^n \phi(X_i)  \]</span> for <span class="math inline">\(\theta = \operatorname{\mathbb E}(\phi(X))\)</span> for <span class="math inline">\(X\)</span> having PDF <span class="math inline">\(\pi\)</span>. Assuming <span class="math inline">\(X_1\)</span> has PDF <span class="math inline">\(\pi\)</span>, derive the result <span class="math display">\[ \operatorname{Var} \left(\frac{1}{n} \sum_{i=1}^n \phi(X_i)\right) \approx \frac{\operatorname{Var}(\phi(X))}{n} \left(1 + 2 \sum_{i=2}^\infty \operatorname{Corr}\big(\phi(X_1),\phi(X_i)\big) \right) . \]</span></p>
<div class="myanswer">
<p><em>Solution.</em> We have <span class="math display">\[ \operatorname{Var} \left(\frac{1}{n} \sum_{i=1}^n \phi(X_i) \right) = \frac{1}{n^2} \left( \sum_{i=1}^n\operatorname{Var}\big(\phi(X_i)\big) + 2 \sum_{i &lt; j} \operatorname{Cov}\big(\phi(X_i),\phi(X_j)\big) \right) . \]</span></p>
<p>Write <span class="math inline">\(\operatorname{Var}(\phi(X)) = \sigma^2\)</span>. Suppose, seeking an approximation, that the Markov chain was started in equilibrium, so with <span class="math inline">\(X_1\)</span> distributed according to <span class="math inline">\(\pi\)</span>. Since <span class="math inline">\(\pi\)</span> is a stationary distribution, we then have all <span class="math inline">\(X_i\)</span> distributed according to <span class="math inline">\(\pi\)</span>. Then <span class="math inline">\(\operatorname{Var}(\phi(X_i)) = \sigma^2\)</span> for all <span class="math inline">\(i\)</span> and <span class="math display">\[ \operatorname{Cov}\big(\phi(X_i),\phi(X_j)\big) = \rho(j-i) \, \sigma^2, \]</span> where <span class="math inline">\(\rho(k) = \operatorname{Corr}(X_1, X_{k+1})\)</span> is the autocorrelation at lag <span class="math inline">\(k\)</span>. We then have <span class="math display">\[\begin{align*}
\operatorname{Var} \left(\frac{1}{n} \sum_{i=1}^n \phi(X_i) \right) &amp;\approx \frac{1}{n^2} \left( n \sigma^2 + 2 \sum_{i &lt; j} \rho(j - i) \sigma^2 \right) \\
&amp;= \frac{\sigma^2}{n^2} \left(n + 2 \sum_{j=1}^n \sum{k=1}^{n-j} \rho(k) \right)
\end{align*}\]</span> We can approximate <span class="math inline">\(\sum_{k=1}^{n-j} \rho(k)\)</span> by <span class="math inline">\(\sum_{k=1}^{\infty} \rho(k)\)</span>, since <span class="math inline">\(n\)</span> is large and the autocorrelation should decay quickly for a well-designed Markov chain. Hence <span class="math display">\[\begin{align*}
\operatorname{Var} \left(\frac{1}{n} \sum_{i=1}^n \phi(X_i) \right) &amp;\approx \frac{\sigma^2}{n^2} \left(n + 2 \sum_{j=1}^n \sum{k=1}^{\infty} \rho(k) \right) \\
&amp;= \frac{\sigma^2}{n^2} \left(n + 2 n \sum{k=1}^{\infty} \rho(k) \right) \\
&amp;= \frac{\sigma^2}{n} \left(1 + 2 \sum{k=1}^{\infty} \rho(k) \right) .
\end{align*}\]</span> This is equivalent to the stated result.</p>
</div>
</div>
</div>
<div class="myq">
<p><strong>4.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Let <span class="math inline">\(\mathbf X = (X_1, \dots, X_n)\)</span> be IID samples from a random variable <span class="math inline">\(X\)</span> with cumulative distribution function <span class="math inline">\(F\)</span>. Let <span class="math inline">\(F^*\)</span> be the empirical cumulative distribution function of the samples <span class="math inline">\(\mathbf X\)</span>.</p>
<div class="subq">
<p><strong>(a)</strong> For fixed <span class="math inline">\(x\)</span>, show that <span class="math inline">\(\operatorname{\mathbb E}F^*(x) = F(x)\)</span>.</p>
<div class="myanswers">
<p><em>Solution.</em> We have <span class="math display">\[ F^*(x) = \frac{1}{n} \sum_{i=1}^n\mathbb{I}_{(-\infty, x]}(X_i) . \]</span> So <span class="math display">\[ \begin{multline}
\operatorname{\mathbb E}F^*(x) = \mathbb E \left( \frac{1}{n} \sum_{i=1}^n\mathbb{I}_{(-\infty, x]}(X_i) \right) = \frac{1}{n} \sum_{i=1}^n \operatorname{\mathbb E} \mathbb{I}_{(-\infty, x]}(X_i) \\ = \frac{1}{n}\,\sum_{i=1}^n \mathbb P\big(X_i \in (\infty, x]\big) = \frac{1}{n}\,n\,\mathbb P\big(X_i \in (\infty, x]\big) = F(x)
\end{multline} \]</span></p>
</div>
</div>
<div class="subq">
<p><strong>(b)</strong> For fixed <span class="math inline">\(x\)</span>, show that <span class="math inline">\(\operatorname{Var}\big(F^*(x)\big) = \displaystyle\frac{1}{n}F(x)\big(1 - F(x)\big)\)</span>.</p>
<div class="myanswers">
<p><em>Solution.</em> With the same notation as part (a), <span class="math display">\[\begin{multline}
\operatorname{Var}\big(F^*(x)\big) = \operatorname{Var} \left( \frac{1}{n} \sum_{i=1}^n\mathbb{I}_{(-\infty, x]}(X_i) \right) = \frac{1}{n^2} \sum_{i=1}^n \operatorname{Var}\big(\mathbb{I}_{(-\infty, x]}(X_i)\big) \\ = \frac{1}{n^2}\,\sum_{i=1}^n F(x) \big(1 - F(x)\big) = \frac{1}{n^2}\,n\,F(x) \big(1 - F(x)\big) = \frac{1}{n} F(x) \big(1 - F(x)\big)
\end{multline}\]</span></p>
</div>
</div>
<div class="subq">
<p><strong>(c)</strong> For fixed <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> with <span class="math inline">\(y &gt; x\)</span>, find <span class="math inline">\(\operatorname{Cov}\big(F^*(y), F^*(x)\big)\)</span>.</p>
<div class="myanswers">
<p><em>Solution.</em> Using the same notation again, <span class="math display">\[\begin{align}
\operatorname{Cov}\big(F(x), F(y)\big)
&amp;= \operatorname{Cov} \left( \frac1n\sum_{i=1}^n \mathbb{I}_{(-\infty, x]}(X_i) ,  \frac1n\sum_{i=1}^n \mathbb{I}_{(-\infty, y]}(X_i) \right) \\
&amp;= \frac{1}{n^2} \left( \sum_{i=1}^n \operatorname{Cov} \big( \mathbb{I}_{(-\infty, x]}(X_i), \mathbb{I}_{(-\infty, y]}(X_i)\big) + 2 \sum_{i&lt;j} \operatorname{Cov} \big( \mathbb{I}_{(-\infty, x]}(X_i), \mathbb{I}_{(-\infty, y]}(X_j)\big) \right) \\
&amp;= \frac{1}{n^2} \left(n \operatorname{Cov} \big( \mathbb{I}_{(-\infty, x]}(X_i), \mathbb{I}_{(-\infty, y]}(X_i)\big) + 0\right) \\
&amp;= \frac{1}{n} \operatorname{Cov} \big( \mathbb{I}_{(-\infty, x]}(X_i), \mathbb{I}_{(-\infty, y]}(X_i)\big).
\end{align}\]</span></p>
<p>So we need to find that covariance. In particular, we have <span class="math display">\[\operatorname{\mathbb E} \big( \mathbb{I}_{(-\infty, x]}(X_i) \mathbb{I}_{(-\infty, y]}(X_i)\big) = F(x),\]</span> since the product of indicator function is 1 if and only if both indicators are 1, which is if <span class="math inline">\(X_i \leq x\)</span> and <span class="math inline">\(X_i \leq y\)</span>. Since <span class="math inline">\(x\)</span> is the smaller, this is <span class="math inline">\(F(x)\)</span>.</p>
<p>Hence we have <span class="math display">\[ \operatorname{Cov}\big(F^*(y), F^*(x)\big) = \frac{1}{n} \big(F(x) - F(x)F(y)\big) = \frac{1}{n}\,F(x) \big(1 - F(y)\big) . \]</span></p>
</div>
</div>
</div>
<div class="myq">
<p><strong>5.</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A random variable <span class="math inline">\(X\)</span> has bounded support, and a statistician wishes to estimate <span class="math inline">\(\theta = \max X\)</span>, the maximum value <span class="math inline">\(X\)</span> can take. The statistician has access to 24 IID samples <span class="math inline">\(X_1, X_2, \dots, X_{24}\)</span> from this random variable which can be read into R as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>   samples <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">12.40</span>,  <span class="fl">2.99</span>, <span class="fl">14.79</span>,  <span class="fl">3.59</span>, <span class="fl">24.92</span>,  <span class="fl">4.11</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>             <span class="fl">22.68</span>, <span class="fl">28.30</span>,  <span class="fl">0.90</span>,  <span class="fl">8.84</span>, <span class="fl">24.17</span>, <span class="fl">31.31</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>             <span class="fl">12.97</span>, <span class="fl">12.43</span>, <span class="fl">20.34</span>, <span class="fl">14.75</span>, <span class="fl">20.61</span>, <span class="fl">10.93</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>             <span class="fl">17.59</span>, <span class="fl">30.88</span>, <span class="fl">28.13</span>,  <span class="fl">0.83</span>, <span class="fl">17.43</span>, <span class="fl">20.78</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="subq">
<p><strong>(a)</strong> Explain why the plug-in estimator is <span class="math inline">\(\theta^* = \max \{X_j : j = 1, \dots, 24\}\)</span>, and find the <span class="math inline">\(\theta^*\)</span> for this data.</p>
<div class="myanswers">
<p><em>Solution.</em> This is basically just the definition of the plug-in estimator. (Not sure why I set that as part of the question…) The maximum value of <span class="math inline">\(X_i\)</span> here is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">12.40</span>,  <span class="fl">2.99</span>, <span class="fl">14.79</span>,  <span class="fl">3.59</span>, <span class="fl">24.92</span>,  <span class="fl">4.11</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>             <span class="fl">22.68</span>, <span class="fl">28.30</span>,  <span class="fl">0.90</span>,  <span class="fl">8.84</span>, <span class="fl">24.17</span>, <span class="fl">31.31</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>             <span class="fl">12.97</span>, <span class="fl">12.43</span>, <span class="fl">20.34</span>, <span class="fl">14.75</span>, <span class="fl">20.61</span>, <span class="fl">10.93</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>             <span class="fl">17.59</span>, <span class="fl">30.88</span>, <span class="fl">28.13</span>,  <span class="fl">0.83</span>, <span class="fl">17.43</span>, <span class="fl">20.78</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>plugin <span class="ot">&lt;-</span> <span class="fu">max</span>(samples)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>plugin</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 31.31</code></pre>
</div>
</div>
<p>So <span class="math inline">\(\theta^* = 31.31\)</span>.</p>
</div>
</div>
<div class="subq">
<p><strong>(b)</strong> Use the bootstrap to estimate the bias of the plug-in estimator.</p>
<div class="myanswers">
<p><em>Solution.</em> The idea is to pick 24 samples <em>with replacement</em> and look at how the maximum of those differs from the overall maximum 31.31.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>boots <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">length</span>(samples)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>bootests <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, boots)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>boots) {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  resample <span class="ot">&lt;-</span> <span class="fu">sample</span>(samples, m, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  bootests[k] <span class="ot">&lt;-</span> <span class="fu">max</span>(resample)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>bias <span class="ot">&lt;-</span> <span class="fu">mean</span>(bootests) <span class="sc">-</span> plugin</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>bias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5259627</code></pre>
</div>
</div>
</div>
</div>
<div class="subq">
<p><strong>(c)</strong> Improve the plug-in estimator by using your estimation of the bias to (approximately) “de-bias” the plug-in estimate.</p>
<div class="myanswers">
<p><em>Solution.</em> We want to subtract the bias from the plugin estimator to debias it. In maths, this is <span class="math inline">\(\theta^* - (\overline{T^*} - \theta^*) = 2\theta^* - \overline{T^*}\)</span>. In code, this is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plugin <span class="sc">-</span> bias</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 31.83596</code></pre>
</div>
</div>
</div>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/mpaldridge\.github\.io\/math5835\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../lectures/L27-bootstrap-ci.html" class="pagination-link" aria-label="Bootstrap III">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Bootstrap III</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../coursework/coursework.html" class="pagination-link" aria-label="Computational coursework">
        <span class="nav-page-text">Computational coursework</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>